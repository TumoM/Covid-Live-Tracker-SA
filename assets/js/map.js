
var tooltip,tooltipText,tooltipRects,provinceList={"NORTH WEST":"ZA-NW","EASTERN CAPE":"ZA-EC","FREE TATE":"ZA-FS",MPUMALANGA:"ZA-MP","NORTHERN CAPE":"ZA-NC",LIMPOPO:"ZA-LP","WESTERN CAPE":"ZA-WC",GAUTENG:"ZA-GT","KWAZULU-NATAL":"ZA-NL",UNALLOCATED:"ZA-UN"},width=415,legendTitle=$("#legTitle")[0],xPen=92,yPen=220,legendSet=!1,colourVal=1,provCase={},provDeath={},provActive={},provRecoveries={},cardList=[];function displayName(e){document.getElementById("country-name").firstChild.data=e}console.log("In Main"),cardList=[],function(){tooltip=document.getElementById("country-name"),tooltipText=tooltip.getElementsByTagName("text")[0],tooltipRects=tooltip.getElementsByTagName("rect");for(var e=0;e<tooltipRects.length;e++)tooltipRects[e].setAttributeNS(null,"width",width)}();for(var svg=document.getElementById("svg-1"),triggers=document.getElementsByClassName("tooltip-trigger"),i=0;i<triggers.length;i++)triggers[i].addEventListener("mousemove",showTooltip),triggers[i].addEventListener("mouseout",hideTooltip);let x,y;function showTooltip(e){svg.getScreenCTM();let t=e.target.getAttributeNS(null,"id");tooltipText.firstChild.data=e.target.getAttributeNS(null,"title"),tooltip.setAttributeNS(null,"transform","translate(10 390)");var o=tooltipText.getComputedTextLength();tooltipText.setAttributeNS(null,"x",(width-o)/2),$("#casesTooltip").text(CommaFormatted(provCase[t])),$("#deathsTooltip").text(CommaFormatted(provDeath[t])),$("#recoveryTooltip").text(CommaFormatted(provRecoveries[t])),tooltip.style.opacity=1}function hideTooltip(){tooltip.style.opacity=0}function colourCountry(e,t,o){var r=document.getElementById(e);$("#"+e).removeClass(),$("#"+e).addClass("land tooltip-trigger valid"),r.classList.add("colour"+o+t)}function colourCountries(e,t=1){for(var o=0;o<e.length;o++)for(var r=0;r<e[o].length;r++)colourCountry(e[o][r],o,t)}function legendSetup(e,t,o){o=Math.round(o);let r=$(".keyText"),l=$(".key.legend");l.removeClass(),l.addClass("key legend");for(let e=0;e<5;e++)l[e].classList.add("colour"+colourVal+e);if(r[0].textContent="0 to "+CommaFormatted(t),r[1].textContent=`${CommaFormatted(t+1)} to ${CommaFormatted(t+o)}`,r[2].textContent=`${CommaFormatted(e-3*o+1)} to ${CommaFormatted(e-2*o)}`,r[3].textContent=`${CommaFormatted(e-2*o+1)} to ${CommaFormatted(e-o)}`,r[4].textContent=`${CommaFormatted(e-o+1)} to ${CommaFormatted(e)}`,console.log("Legend Set:",legendSet),!legendSet){let e=$("rect.key:nth-child(7)")[0].getBoundingClientRect().width+$("text.keyText:nth-child(12)")[0].getBoundingClientRect().width;console.log("WIDTH:",e),$(".lightBack").width("55%");let t=legendTitle.getComputedTextLength();legendTitle.setAttributeNS(null,"x",(e-t)/2-xPen),legendSet=!0}}function setColours(e,t=1){colourVal=t,console.log("Setting Vars");let o=0,r=1/0,l=0,s=0,i=[[],[],[],[],[]];console.log("Setting Range"),Object.keys(e).forEach(t=>{null!==e[t]&&(r=Math.min(r,e[t]),o=Math.max(o,e[t]))}),o=10*Math.round(Math.ceil(o/10)),r=10*Math.round(Math.floor(r/10)),l=o-r,s=l/4,console.log("For Each Loop"),Object.keys(e).forEach(t=>{if("ZA-UN"!==t){let r=e[t];o-s<r&&r<=o?i[4].push(t):o-2*s<=r?i[3].push(t):o-3*s<=r?i[2].push(t):o-4*s<r?i[1].push(t):i[0].push(t)}}),console.log("ANSWERS:",i),colourCountries(i,t),legendSetup(o,r,s)}function setProvs(e,t,o,r){provCase=e,provDeath=t,provRecoveries=o,provActive=r,console.log("Recovs 1:",o),setupSideBCards()}function CommaFormatted(e){var t=parseInt(e);if(isNaN(t))return"N/A";var o="";t<0&&(o="-"),t=Math.abs(t);for(var r=new String(t),l=[];r.length>3;){var s=r.substr(r.length-3);l.unshift(s),r=r.substr(0,r.length-3)}return r.length>0&&l.unshift(r),e=o+(e=r=l.join(","))}function compareValues(e,t="desc"){return function(o,r){if(!o.hasOwnProperty(e)||!r.hasOwnProperty(e))return 0;const l="string"==typeof o[e]?o[e].toUpperCase():o[e],s="string"==typeof r[e]?r[e].toUpperCase():r[e];let i=0;try{l>s?i=1:l<s&&(i=-1)}catch(e){console.log("Error",e),console.log("-",l)}return"desc"===t?-1*i:i}}function setupSideBCards(){let e;for(const[t,o]of Object.entries(provinceList))e={name:t,cases:provCase[o],deaths:provDeath[o],recoveries:provRecoveries[o],active:provActive[o]},cardList.push(e)}function populateSideCards(e){let t,o=0,r=$("#mapContainer .card");console.log("Cards",r),e.forEach(e=>{console.log("Counter",o),t=r[o].children[1].children[0].children,r[o].firstElementChild.firstElementChild.innerText=e.name,t[0].innerText=CommaFormatted(e.cases),t[2].innerText=CommaFormatted(e.deaths),t[4].innerText=CommaFormatted(e.recoveries),t[6].innerText=CommaFormatted(e.recoveries),o++})}triggers=document.getElementsByClassName("keyText"),Object.values(triggers).forEach(e=>{x=e.getAttribute("x"),y=e.getAttribute("y"),e.setAttribute("x",x-xPen),e.setAttribute("y",y-yPen)}),triggers=document.getElementsByClassName("key legend"),Object.values(triggers).forEach(e=>{x=e.getAttribute("x"),y=e.getAttribute("y"),e.setAttribute("x",x-xPen),e.setAttribute("y",y-yPen)}),x=$("#legTitle").attr("x"),y=$("#legTitle").attr("y"),$("#legTitle").attr({x:-x-xPen,y:y-yPen}),x=$(".lightBack").attr("x"),y=$(".lightBack").attr("y"),$(".lightBack").attr({x:x-xPen,y:y-yPen}),console.log("MAX HEIGHT:",$("#svg-1").height()+Number($("#svgColumn").css("padding-top").split(/\D/)[0])),$("#provStatsContainer").css("max-height",$("#svg-1").height()+2*parseInt($("#svgColumn").css("padding-top"))),$(window).resize(()=>{$("#provStatsContainer").css("max-height",$("#svg-1").height()+2*parseInt($("#svgColumn").css("padding-top")))}),$(document).ready(()=>{$((function(){$(".scroll-pane").jScrollPane({showArrows:!0,resizeSensor:!0})})),$(".toggle.button.map").click(e=>{console.log("you clicked me!"),$("#svgColumn").toggleClass("ten wide"),$("#svgColumn").toggleClass("fourteen wide svgFocus"),$("#provStatsContainer").toggleClass("sidebarHidden"),$("#hideIcon").toggleClass("fa-rotate-180")}),$("#filterC").click(e=>{console.log("you clicked me to filter!"),setColours(provCase,1),populateSideCards(cardList.sort(compareValues("cases")))}),$("#filterD").click(e=>{console.log("you clicked me to filter!"),setColours(provDeath,2),populateSideCards(cardList.sort(compareValues("deaths")))}),$("#filterR").click(e=>{console.log("you clicked me to filter!"),setColours(provRecoveries,3),populateSideCards(cardList.sort(compareValues("recoveries")))}),$("#filterA").click(e=>{console.log("you clicked me to filter!"),setColours(provRecoveries,3),populateSideCards(cardList.sort(compareValues("active")))}),$("#filterC2").click(e=>{console.log("you clicked me to filter!"),setColours(provCase,1),populateSideCards(cardList.sort(compareValues("cases")))}),$("#filterD2").click(e=>{console.log("you clicked me to filter!"),setColours(provDeath,2),populateSideCards(cardList.sort(compareValues("deaths")))}),$("#filterR2").click(e=>{console.log("you clicked me to filter!"),setColours(provRecoveries,3),populateSideCards(cardList.sort(compareValues("recoveries")))})});

