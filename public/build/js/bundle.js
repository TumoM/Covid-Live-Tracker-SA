let ctx,chart1,chart2,chart3,chart4,chart5,chart6,data,now,typeCases="linear",typeDeaths="linear",mode="x",intersect="false",labels=[],totalCasesArr=[],provinceNameArr=[],provinceCaseArr=[],totalDeathsArr=[],activeCasesArr=[],dailyNewArr=[],dailyDeathsArr=[],timeFormat="MM/DD/YYYY HH:mm",date="MMM DD",dragOptions={animationDuration:1e3};titleCallback=(e,t)=>{let a=t.labels[e[0].index].toString();return a=a.split(" ",5),a=`${a[1]} ${a[2]}, ${a[3]}`,a},labelCallback=(e,t)=>String(t.datasets[0].data[e.index]),Chart.defaults.global.hover.mode="x",Chart.defaults.global.hover.intersect=!1,Chart.defaults.global.tooltips.mode="x",Chart.defaults.global.tooltips.intersect=!1,Chart.scaleService.updateScaleDefaults("logarithmic",{ticks:{callback:function(e,t){if(0!==e)return numeral(e).format("0a")},autoSkip:!0,autoSkipPadding:100,min:0,minRotation:0,drawTicks:!1,beforeTickToLabelConversion:function(e){return console.log("Label",e),e}}}),Chart.defaults.global.tooltips.callbacks.title=titleCallback,Chart.defaults.global.tooltips.callbacks.label=labelCallback,Chart.defaults.global.tooltips.bodyAlign="center",Chart.defaults.global.tooltips.titleAlign="center",Chart.scaleService.updateScaleDefaults("linear",{xAxes:[{ticks:{min:"2020-03-20",max:moment()}}]}),Chart.defaults.scale.ticks.beginAtZero=!0,setGraphs=(e,t)=>{e.forEach(e=>{labels.push(new Date(e.date)),totalCasesArr.push(e.totalCases),totalDeathsArr.push(e.totalDeaths),activeCasesArr.push(e.activeCases),dailyNewArr.push(e.dailyNew),dailyDeathsArr.push(e.dailyDeaths)}),now=moment(),ctx=document.getElementById("chart1").getContext("2d"),chart1=new Chart(ctx,{type:"line",responsive:!0,maintainAspectRatio:!0,data:{labels:labels,datasets:[{label:"# Cases",backgroundColor:"rgb(210,210,210)",borderColor:"rgb(102,0,80)",data:totalCasesArr,fill:!0}]},options:{plugins:{zoom:{pan:{enabled:!0,mode:"x"},zoom:{enabled:!1,mode:"x",drag:dragOptions,speed:.05}}},elements:{point:{radius:0}},title:{display:!0,text:"Total Cases "+typeCases},scales:{xAxes:[{display:!0,type:"time",gridLines:{drawOnChartArea:!1},ticks:{min:moment("2020-03-01")},time:{unit:"day",displayFormats:{day:"MMM DD",year:"MMM DD YY"}}}],yAxes:[{display:!0,labelAutoFit:!1,type:typeCases}]}}}),ctx=document.getElementById("chart2").getContext("2d"),chart2=new Chart(ctx,{type:"bar",responsive:!0,maintainAspectRatio:!0,data:{labels:labels,datasets:[{label:"New Cases",data:dailyNewArr,backgroundColor:"rgb(109,35,35)",borderColor:"rgb(109,35,35)",borderWidth:0,maxBarThickness:100}]},options:{scales:{yAxes:[{ticks:{min:Math.min.apply(this,dailyNewArr),beginAtZero:!0}}],xAxes:[{type:"time",gridLines:{drawOnChartArea:!1},ticks:{min:moment("2020-03-01")},time:{unit:"day",displayFormats:{day:"MMM DD",year:"MMM DD YY"}}}]}}}),ctx=document.getElementById("chart3").getContext("2d"),chart3=new Chart(ctx,{type:"line",responsive:!0,maintainAspectRatio:!0,data:{labels:labels,datasets:[{label:"# Deaths",backgroundColor:"rgb(210,210,210)",borderColor:"rgb(139,51,67)",data:totalDeathsArr,fill:!0}]},options:{tooltips:{mode:"nearest"},title:{display:!0,text:"Total Deaths "+typeDeaths},elements:{point:{radius:0}},scales:{xAxes:[{display:!0,ticks:{min:moment("2020-03-01")},gridLines:{drawOnChartArea:!1},type:"time",time:{unit:"day",displayFormats:{day:"MMM DD"}}}],yAxes:[{display:!0,type:typeDeaths}]}}}),ctx=document.getElementById("chart4").getContext("2d"),chart4=new Chart(ctx,{type:"bar",responsive:!0,maintainAspectRatio:!0,data:{labels:labels,datasets:[{label:"Daily Deaths",data:dailyDeathsArr,backgroundColor:"rgb(109,35,35)",borderColor:"rgb(109,35,35)",borderWidth:0,maxBarThickness:100}]},options:{scales:{yAxes:[{ticks:{min:Math.min.apply(this,dailyDeathsArr),beginAtZero:!0}}],xAxes:[{type:"time",ticks:{min:moment("2020-03-01")},gridLines:{drawOnChartArea:!1},time:{unit:"day",displayFormats:{day:"MMM DD",year:"MMM DD YY"}}}]}}}),ctx=document.getElementById("chart5").getContext("2d"),chart5=new Chart(ctx,{type:"line",responsive:!0,maintainAspectRatio:!0,data:{labels:labels,datasets:[{label:"# of Cases",backgroundColor:"rgb(210,210,210)",borderColor:"rgb(31,206,102)",data:activeCasesArr,fill:!0}]},options:{title:{display:!0,text:"Active Cases"},elements:{point:{radius:0}},scales:{xAxes:[{display:!0,type:"time",ticks:{min:moment("2020-03-01")},gridLines:{drawOnChartArea:!1},time:{unit:"day",displayFormats:{day:"MMM DD"}}}],yAxes:[{display:!0,type:"linear"}]}}}),document.getElementById("toggleScaleCases").addEventListener("click",(function(){typeCases="linear"===typeCases?"logarithmic":"linear",chart1.options.title.text="Total Cases - "+typeCases,chart1.options.scales.yAxes[0]={display:!0,type:typeCases},chart1.update()})),document.getElementById("toggleScaleDeaths").addEventListener("click",(function(){typeDeaths="linear"===typeDeaths?"logarithmic":"linear",chart3.options.title.text="Total Deaths - "+typeDeaths,chart3.options.scales.yAxes[0]={display:!0,type:typeDeaths},chart3.update()}))};const provinceList={"NORTH WEST":"ZA-NW","EASTERN CAPE":"ZA-EC","FREE TATE":"ZA-FS",MPUMALANGA:"ZA-MP","NORTHERN CAPE":"ZA-NC",LIMPOPO:"ZA-LP","WESTERN CAPE":"ZA-WC",GAUTENG:"ZA-GT","KWAZULU-NATAL":"ZA-NL",UNALLOCATED:"ZA-UN"};var tooltip,tooltipText,tooltipRects;let width=415,legendTitle=$("#legTitle")[0];const xPen=92,yPen=220;let x,y,legendSet=!1,colourVal=1,provCase={},provDeath={},provRecoveries={},cardList=[];function displayName(e){document.getElementById("country-name").firstChild.data=e}!function(){tooltip=document.getElementById("country-name"),tooltipText=tooltip.getElementsByTagName("text")[0],tooltipRects=tooltip.getElementsByTagName("rect");for(var e=0;e<tooltipRects.length;e++)tooltipRects[e].setAttributeNS(null,"width",width)}();for(var svg=document.getElementById("svg-1"),triggers=document.getElementsByClassName("tooltip-trigger"),i=0;i<triggers.length;i++)triggers[i].addEventListener("mousemove",showTooltip),triggers[i].addEventListener("mouseout",hideTooltip);function showTooltip(e){svg.getScreenCTM();let t=e.target.getAttributeNS(null,"id");tooltipText.firstChild.data=e.target.getAttributeNS(null,"title"),tooltip.setAttributeNS(null,"transform","translate(10 390)");var a=tooltipText.getComputedTextLength();tooltipText.setAttributeNS(null,"x",(width-a)/2),$("#casesTooltip").text(CommaFormatted(provCase[t])),$("#deathsTooltip").text(CommaFormatted(provDeath[t])),$("#recoveryTooltip").text(CommaFormatted(provRecoveries[t])),tooltip.style.opacity=1}function hideTooltip(){tooltip.style.opacity=0}function colourCountry(e,t,a){var o=document.getElementById(e);$("#"+e).removeClass(),$("#"+e).addClass("land tooltip-trigger valid"),o.classList.add("colour"+a+t)}function colourCountries(e,t=1){for(var a=0;a<e.length;a++)for(var o=0;o<e[a].length;o++)colourCountry(e[a][o],a,t)}function legendSetup(e,t,a){a=Math.round(a);let o=$(".keyText"),r=$(".key.legend");r.removeClass(),r.addClass("key legend");for(let e=0;e<5;e++)r[e].classList.add("colour"+colourVal+e);if(o[0].textContent="0 to "+CommaFormatted(t),o[1].textContent=`${CommaFormatted(t+1)} to ${CommaFormatted(t+a)}`,o[2].textContent=`${CommaFormatted(e-3*a+1)} to ${CommaFormatted(e-2*a)}`,o[3].textContent=`${CommaFormatted(e-2*a+1)} to ${CommaFormatted(e-a)}`,o[4].textContent=`${CommaFormatted(e-a+1)} to ${CommaFormatted(e)}`,console.log("Legend Set:",legendSet),!legendSet){let e=$("rect.key:nth-child(7)")[0].getBoundingClientRect().width+$("text.keyText:nth-child(12)")[0].getBoundingClientRect().width;console.log("WIDTH:",e),$(".lightBack").width("55%");let t=legendTitle.getComputedTextLength();legendTitle.setAttributeNS(null,"x",(e-t)/2-92),legendSet=!0}}function setColours(e,t=1){let a=0,o=1/0,r=0,s=0,l=[[],[],[],[],[]];Object.keys(e).forEach(t=>{null!==e[t]&&(o=Math.min(o,e[t]),a=Math.max(a,e[t]))}),a=10*Math.round(Math.ceil(a/10)),o=10*Math.round(Math.floor(o/10)),r=a-o,s=r/4,Object.keys(e).forEach(t=>{if("ZA-UN"!==t){let o=e[t];a-s<o&&o<=a?l[4].push(t):a-2*s<=o?l[3].push(t):a-3*s<=o?l[2].push(t):a-4*s<o?l[1].push(t):l[0].push(t)}}),console.log("ANSWERS:",l),colourVal=t,colourCountries(l,t),legendSetup(a,o,s)}function setProvs(e,t,a){provCase=e,provDeath=t,provRecoveries=a,console.log("Recovs 1:",a),setupSideBCards()}function CommaFormatted(e){var t=parseInt(e);if(isNaN(t))return"N/A";var a="";t<0&&(a="-"),t=Math.abs(t);for(var o=new String(t),r=[];o.length>3;){var s=o.substr(o.length-3);r.unshift(s),o=o.substr(0,o.length-3)}return o.length>0&&r.unshift(o),a+r.join(",")}function compareValues(e,t="desc"){return function(a,o){if(!a.hasOwnProperty(e)||!o.hasOwnProperty(e))return 0;const r="string"==typeof a[e]?a[e].toUpperCase():a[e],s="string"==typeof o[e]?o[e].toUpperCase():o[e];let l=0;try{r>s?l=1:r<s&&(l=-1)}catch(e){console.log("Error",e),console.log("-",r)}return"desc"===t?-1*l:l}}function setupSideBCards(){let e;for(const[t,a]of Object.entries(provinceList))e={name:t,cases:provCase[a],deaths:provDeath[a],recoveries:provRecoveries[a]},cardList.push(e);populateSideCards(cardList.sort(compareValues("cases")))}function populateSideCards(e){let t,a=0,o=$("#mapContainer .card");console.log("Cards",o),e.forEach(e=>{console.log("Counter",a),t=o[a].children[1].children[0].children,o[a].firstElementChild.firstElementChild.innerText=e.name,t[0].innerText=CommaFormatted(e.cases),t[2].innerText=CommaFormatted(e.deaths),t[4].innerText=CommaFormatted(e.recoveries),a++})}triggers=document.getElementsByClassName("keyText"),Object.values(triggers).forEach(e=>{x=e.getAttribute("x"),y=e.getAttribute("y"),e.setAttribute("x",x-92),e.setAttribute("y",y-220)}),triggers=document.getElementsByClassName("key legend"),Object.values(triggers).forEach(e=>{x=e.getAttribute("x"),y=e.getAttribute("y"),e.setAttribute("x",x-92),e.setAttribute("y",y-220)}),x=$("#legTitle").attr("x"),y=$("#legTitle").attr("y"),$("#legTitle").attr({x:-x-92,y:y-220}),x=$(".lightBack").attr("x"),y=$(".lightBack").attr("y"),$(".lightBack").attr({x:x-92,y:y-220}),console.log("MAX HEIGHT:",$("#svg-1").height()+Number($("#svgColumn").css("padding-top").split(/\D/)[0])),$("#provStatsContainer").css("max-height",$("#svg-1").height()+2*parseInt($("#svgColumn").css("padding-top"))),$(window).resize(()=>{$("#provStatsContainer").css("max-height",$("#svg-1").height()+2*parseInt($("#svgColumn").css("padding-top")))}),$(document).ready(()=>{$((function(){$(".scroll-pane").jScrollPane({showArrows:!0,resizeSensor:!0})})),$(".toggle.button.map").click(e=>{console.log("you clicked me!"),$("#svgColumn").toggleClass("ten wide"),$("#svgColumn").toggleClass("fourteen wide svgFocus"),$("#provStatsContainer").toggleClass("sidebarHidden"),$("#hideIcon").toggleClass("fa-rotate-180")}),$("#filterC").click(e=>{console.log("you clicked me to filter!"),setColours(provCase,1),populateSideCards(cardList.sort(compareValues("cases")))}),$("#filterD").click(e=>{console.log("you clicked me to filter!"),setColours(provDeath,2),populateSideCards(cardList.sort(compareValues("deaths")))}),$("#filterR").click(e=>{console.log("you clicked me to filter!"),setColours(provRecoveries,3),populateSideCards(cardList.sort(compareValues("recoveries")))}),$("#filterC2").click(e=>{console.log("you clicked me to filter!"),setColours(provCase,1),populateSideCards(cardList.sort(compareValues("cases")))}),$("#filterD2").click(e=>{console.log("you clicked me to filter!"),setColours(provDeath,2),populateSideCards(cardList.sort(compareValues("deaths")))}),$("#filterR2").click(e=>{console.log("you clicked me to filter!"),setColours(provRecoveries,3),populateSideCards(cardList.sort(compareValues("recoveries")))})});let dummyData=[{id:1,name:"Billy Bob",age:"12",gender:"male",height:1,col:"red",dob:"",cheese:1},{id:2,name:"Mary May",age:"1",gender:"female",height:2,col:"blue",dob:"14/05/1982",cheese:!0},{id:3,name:"Christine Lobowski",age:"42",height:0,col:"green",dob:"22/05/1982",cheese:"true"},{id:4,name:"Brendon Philips",age:"125",gender:"male",height:1,col:"orange",dob:"01/08/1980"},{id:5,name:"Margret Marmajuke",age:"16",gender:"female",height:5,col:"yellow",dob:"31/01/1999"},{id:6,name:"Billy Bob",age:"12",gender:"male",height:1,col:"red",dob:"",cheese:1},{id:7,name:"Mary May",age:"1",gender:"female",height:2,col:"blue",dob:"14/05/1982",cheese:!0},{id:8,name:"Christine Lobowski",age:"42",height:0,col:"green",dob:"22/05/1982",cheese:"true"},{id:9,name:"Brendon Philips",age:"125",gender:"male",height:1,col:"orange",dob:"01/08/1980"},{id:10,name:"Margret Marmajuke",age:"16",gender:"female",height:5,col:"yellow",dob:"31/01/1999"}];var dateMutator=function(e,t,a,o,r){return new Date(e)},dateFormatter=function(e,t){var a=e.getValue();return a&&(a=moment(a).format("MMM DD, YYYY")),a},numberFormat=function(e,t,a,o,r){return null===e?null:numeral(e).format("0,0")};setTable=e=>{var t=document.getElementById("sort-field"),a=document.getElementById("sort-direction"),o=new Tabulator("#example-table",{index:"date",layout:"fitColumns",responsiveLayout:"hide",height:"100%",sortOrderReverse:!0,movableColumns:!0,pagination:"local",paginationSize:30,paginationSizeSelector:[10,20,30,50,100,200,500],initialSort:[{column:"date",dir:"desc"}],resizableColumns:!1,columns:[{title:"Date",field:"date",headerSortTristate:!0,sorter:"datetime",sorterParams:{format:"YYYY/MM/DD",alignEmptyValues:"bottom"},mutator:dateMutator,formatter:"datetime",formatterParams:{outputFormat:"MMM DD, YYYY",invalidPlaceholder:"(invalid date)"}},{title:"Total Cases",field:"totalCases",sorter:"number",headerSortStartingDir:"desc",headerSortTristate:!0,mutator:numberFormat},{title:"Total Deaths",field:"totalDeaths",sorter:"number",headerSortStartingDir:"desc",headerSortTristate:!0,mutator:numberFormat},{title:"Total Recoveries",field:"totalRecoveries",sorter:"number",headerSortStartingDir:"desc",headerSortTristate:!0,mutator:numberFormat},{title:"Active Cases",field:"activeCases",sorter:"number",headerSortStartingDir:"desc",headerSortTristate:!0,mutator:numberFormat},{title:"Total Tests",field:"totalTests",sorter:"number",headerSortStartingDir:"desc",headerSortTristate:!0,sorterParams:{alignEmptyValues:"bottom"},formatter:function(e,t,a){let o=e.getValue();return o||(o="N/A"),o},headerSortStartingDir:"desc",headerSortTristate:!0,mutator:numberFormat},{title:"Daily Cases",field:"dailyNew",sorter:"number",headerSortStartingDir:"desc",headerSortTristate:!0,mutator:numberFormat},{title:"Daily Deaths",field:"dailyDeaths",sorter:"number",headerSortStartingDir:"desc",headerSortTristate:!0,mutator:numberFormat}]});o.setData(e).then((function(){document.getElementById("sort-trigger").addEventListener("click",(function(){o.setSort(t.options[t.selectedIndex].value,a.options[a.selectedIndex].value)})),document.getElementById("sort-reset").addEventListener("click",(function(){o.clearSort(),o.setSort("date","desc")}))})).catch((function(e){}))};